import numpy as np,cPickle

class line_candidate(object):
	def dist3d(self,pos1,pos2):
		return np.sqrt((pos1[0]-pos2[0])**2+(pos1[1]-pos2[1])**2+(pos1[2]-pos2[2])**2)
	def dist2d(self,pos1,pos2):
		return np.sqrt((pos1[0]-pos2[0])**2+(pos1[1]-pos2[1])**2)
	def __init__(self,reduint_entry):
		self.SNR=reduint_entry[0]
		self.posn=reduint_entry[1]
		#if self.dist2d(self.posn,(257, 345,0))<5:
		#	print 'this is probably continuum'
		self.spat_templ=reduint_entry[3][0]
		self.freq_templ=reduint_entry[3][1]
		self.reduint_entry=reduint_entry
		inp=open('/data2/common/goodsN/SNRanalysis_57w/MF3D/spectra_positive_combined_nosmooth.txt')
		for idx,line in enumerate(inp):
			splitt=line.split()
			if int(splitt[1][1:-1])==self.posn[0] and int(splitt[2][:-1])==self.posn[1] and int(splitt[3][:-2])==self.posn[2]:
				try:
					self.aper_flux=float(splitt[13])
					self.aper_maj=float(splitt[7])
					self.aper_min=float(splitt[9])
					self.aper_freq=float(splitt[11])
					self.aper_FWHM=float(splitt[15])
					self.aper_int_flux=float(splitt[17])
				except:
					print 'Aper flux reading failed'
					self.aper_flux=np.nan
					self.aper_maj=np.nan
					self.aper_min=np.nan
					self.aper_freq=np.nan
					self.aper_FWHM=np.nan
					self.aper_int_flux=np.nan
				break
		inp.close()
		if self.spat_templ==-1:
			inp=open('/data2/common/goodsN/singlepointings/no_smooth/SNRanalysis/MF3D/spectra_positive_1pix.txt')
			for idx,line in enumerate(inp):
				splitt=line.split()
				if float(splitt[0][1:-1])==self.SNR:
					try:
						self.pix_flux=float(splitt[9])
						self.pix_freq=float(splitt[7])
						self.pix_FWHM=float(splitt[11])
						self.pix_int_flux=float(splitt[13])
					except:
						print '1pix flux reading failed'
						self.pix_flux=np.nan
						self.pix_freq=np.nan
						self.pix_FWHM=np.nan
						self.pix_int_flux=np.nan
					break
			inp.close()
		else:
			self.pix_flux=np.nan
			self.pix_freq=np.nan
			self.pix_FWHM=np.nan
			self.pix_int_flux=np.nan
		if self.SNR>6.5:
			self.purity=1
		else:
			self.assign_purity()
		self.assign_flux_corr()
		inp=open('/data2/common/goodsN/artificial/post_size_881002.dat')
		posterior=cPickle.load(inp)
		inp.close()
		SNRbins=np.arange(4,7,.1)
		SNRbin_idx=np.digitize(self.SNR,SNRbins)-1
		self.size_prob=np.array([np.mean(posterior[self.spat_templ][inj_size][(SNRbin_idx-3):(SNRbin_idx+3)]) for inj_size in range(3)])
		inp=open('/data2/common/goodsN/artificial/post_FWHM_343333.dat')
		posterior_freq=cPickle.load(inp)
		inp.close()
		self.FWHM_prob=np.array([np.mean(posterior_freq[self.freq_templ][inj_FWHM][(SNRbin_idx-3):(SNRbin_idx+3)]) for inj_FWHM in range(3)])
		if self.spat_templ==-1:
			self.fiducial_int_flux=self.pix_int_flux
		else:
			self.fiducial_int_flux=self.aper_int_flux
		self.completeness=self.assign_compl(self.fiducial_int_flux)   
		self.L_prime=self.calc_L_prime(self.fiducial_int_flux,self.aper_freq)   
		self.ra,self.dec=self.calc_ra_dec_freq(self.posn)[:2]
	def assign_purity(self):
		purity_list=[(6.3787398338317871, 0.69638021901128611), (6.1397081335444383, 0.46463942540072201), (6.1353536400579953, 1.), (6.0771536827087402, 0.40244356557087901), (6.0593472021053438, 0.38523483242763584), (5.999498532351855, 0.32977898993742694), (5.966244586128771, 0.30088897341005683), (5.8916816711425781, 0.24205002907908107), (5.8759499583026686, 0.23075863205323566), (5.8284187316894531, 0.19908894162179494), (5.8124513626098633, 0.18927179095296368), (5.8067856724781599, 0.18588659743310465), (5.8034805710434041, 0.18393543894667269), (5.6524477005004883, 0.1120781619877622), (5.6400434687554695, 0.10753830365997677), (5.6302310248665766, 0.10407539177222311), (5.6273612684342345, 0.1030835980729664), (5.6153931005715014, 0.099047510231917046), (5.6136555671691895, 0.098474783255891901), (5.602501318888562, 0.094876216540978497), (5.5992416680064077, 0.093849734931658865), (5.5945631135501452, 0.092395955231625831), (5.5897271140895572, 0.090917148624427624), (5.5629539489746094, 0.083154656173600086), (5.5535618453090239, 0.080595221648858503), (5.5407942806846311, 0.077245718550857531), (5.5379783645476222, 0.076526597533164584), (5.5146455764770508, 0.070829933218299251), (5.5100846102672012, 0.069769273173824808), (5.5081391334533691, 0.069321946599274056), (5.4922447204589844, 0.065778785077670168), (5.4805184952635679, 0.063288092945072635), (5.4771368230113291, 0.062588611357357216), (5.469665282971877, 0.061072260528239164), (5.4628787040710449, 0.05972897154340262), (5.4622343394337847, 0.059603087400467991), (5.4512537419722342, 0.057501169857114801), (5.4426462346939504, 0.055909376980202839), (5.4350762367248535, 0.054548795707299688), (5.4305567741394043, 0.053753640888817615), (5.4282169438354426, 0.053346923966021038), (5.4271397590637207, 0.053160809815987996), (5.4251118410972436, 0.052812343238101266), (5.416776562819682, 0.051405961461867704), (5.4154108586408656, 0.051179451253147351), (5.4151001551434774, 0.051128071560850669), (5.4124247816205715, 0.05068798143976154), (5.4111062239923529, 0.050472607936996566), (5.4070615637049633, 0.049818175076779825), (5.4048484855182206, 0.049464033261337893), (5.4034132208549144, 0.049235834622287145), (5.4006396897594504, 0.048798124660963761), (5.3988690376281738, 0.048520920885284223), (5.3975882580998134, 0.048321487146769704), (5.3971091087244556, 0.048247109153020891), (5.3933752564958963, 0.047671800421804113), (5.3916111253198071, 0.047402613914393432), (5.3894555231948944, 0.047075963396386269), (5.3870773275196138, 0.046718457491180476), (5.3865934957052737, 0.046646091851279131), (5.3841944318846471, 0.046289091564083222), (5.3834014423614631, 0.046171752313855605), (5.3828642808423472, 0.046092454750068602), (5.381627082824707, 0.045910387134201813), (5.3815221786499023, 0.045894985886216627), (5.380161093464686, 0.045695678321184374), (5.3758797869338517, 0.04507496899964155), (5.375789258936698, 0.045061945263628257), (5.3753480824973447, 0.044998535376724068), (5.3695745468139648, 0.044177759168257127), (5.3685804217994963, 0.044038114876489717), (5.3655842307598434, 0.043620196409123006), (5.3619072526541061, 0.043113329607750973), (5.3567392951036474, 0.042411973153389806), (5.3552275139074021, 0.042209214638576915), (5.3550141950882999, 0.04218069161415551), (5.3533232971042706, 0.041955359099451882), (5.3516416709319516, 0.041732592935573), (5.3515228228079144, 0.041716899046014694), (5.3453197822332346, 0.040906864412985113), (5.3389495876425102, 0.040093261790203949), (5.3359274864196777, 0.039713629934143686), (5.3356967513631011, 0.039684811361490158), (5.333989320265899, 0.039472282645259961), (5.3276361634956357, 0.038692636971733502), (5.3264613151550293, 0.03855036647780518), (5.3261656761169434, 0.038514658236994022), (5.3223810167547745, 0.038060808070972757), (5.3155011347681258, 0.037251132602800906), (5.3153028873873298, 0.037228091112708188), (5.315129759070377, 0.037207982269489327), (5.3150300557092747, 0.037196407294820003), (5.313279836630084, 0.036993877847495006), (5.3129260585429083, 0.036953091331900015), (5.310735944574617, 0.036701724612653419), (5.3065336289759788, 0.036224805755416992), (5.3059857114519611, 0.036163141204911355), (5.3018452523213639, 0.035700984286580285), (5.2972212131155425, 0.035192746309097828), (5.2962533622626538, 0.035087409875964065), (5.295146577664994, 0.034967391095167971), (5.2943778038024902, 0.034884300359987366), (5.2914203524621231, 0.034566738007826524), (5.289726887842308, 0.034386379480346667), (5.2882620219361813, 0.034231230676201659), (5.2852423240150506, 0.033913912677980669), (5.28413360718171, 0.033798247783377908), (5.2841072082519531, 0.033795499247390379), (5.280606890618075, 0.033433309094820007), (5.2778287221569791, 0.03314899295975382), (5.277724850577588, 0.033138416460066836), (5.2766761779785156, 0.033031853236082251), (5.2753402953983333, 0.032896671053359826), (5.2749396689555583, 0.032856253705843289), (5.2740904301806824, 0.032770765482805074), (5.2739773899990583, 0.032759405533975994), (5.2723101651636668, 0.032592380034446422), (5.2718198556384657, 0.032543445467978757), (5.2710304260253906, 0.032464834214572351), (5.2701412867715565, 0.032376553984461529), (5.2698569388006868, 0.032348379854811968), (5.2689428329467773, 0.032257997223693609), (5.2686815184465665, 0.032232212803811375), (5.2650589942932129, 0.031877192483304319), (5.2648004298591697, 0.03185202408101398), (5.2647671699523926, 0.031848788249221618), (5.2630753298438222, 0.031684686568640812), (5.2604360580444336, 0.031430620954576403), (5.2559429794665062, 0.031003463000583133), (5.2548641010969339, 0.03090188957655917), (5.2532949607586676, 0.030754841659557136), (5.2523202108415861, 0.030663900897645875), (5.2515878677368164, 0.030595779422148518), (5.2515301704406738, 0.030590419911546728), (5.249366504139422, 0.030390214790204897), (5.2480931282043457, 0.030273094281048407), (5.2431520477445277, 0.029823531811594473), (5.2431489561674391, 0.029823252946427785), (5.243134657623405, 0.029821963234180616), (5.2425491902122827, 0.029769209984509631), (5.2401651978299615, 0.029555511122180283), (5.2400206666010769, 0.029542612540679306), (5.2361010912781971, 0.029195280849374262), (5.2305198637611747, 0.028708821671257611), (5.2302705468367066, 0.028687311181739773), (5.2300004788103172, 0.028664031401026455), (5.2271535227590036, 0.028419951938587665), (5.2257177649104207, 0.028297774011237189), (5.2246365945295521, 0.028206172342559968), (5.2234482765197754, 0.028105889360176758), (5.2223157585923019, 0.028010700430422683), (5.2196288108825684, 0.027786354862515059), (5.2187667131347864, 0.027714817327245254), (5.2174672252937944, 0.027607389088617155), (5.2160892371631427, 0.027493999964418994), (5.2152347564697266, 0.027423960353297458), (5.2149467125582456, 0.027400396938256553), (5.2149216259107725, 0.02739834584235094), (5.2143783569335938, 0.027353971732054092), (5.2134315578519761, 0.027276837170758968), (5.2121636247985812, 0.027173936603832327), (5.2114691792950909, 0.02711776976055923), (5.2073147732050664, 0.026784573189553889), (5.2039017677307129, 0.026514408979187269), (5.2020387098339507, 0.026368277402356453), (5.2006378389657533, 0.026259017757921332), (5.1995296478271484, 0.026172960209659441), (5.1990692500405071, 0.026137304613705732), (5.197101461223717, 0.025985547817351656), (5.1937857447963687, 0.025732164647407386), (5.1932929142829032, 0.025694750621707632), (5.1921415328979492, 0.025607589768116546), (5.1903111985961017, 0.025469743704752645), (5.1849884213737294, 0.02507379409219785), (5.1846176729406093, 0.025046485164216002), (5.1843380849510909, 0.025025914123290749), (5.1813092231750488, 0.024804329580559378), (5.1794276237487793, 0.024667837681569865), (5.1788940044085043, 0.024629289695374028), (5.1781392731517899, 0.024574889827836014), (5.1779062455287495, 0.024558122136603324), (5.1750235557556152, 0.0243518058742896), (5.1743106842041016, 0.024301100422399181), (5.173581515629162, 0.024249364451742146), (5.1732939989599371, 0.024229000261197106), (5.1716168183894604, 0.0241106101832506), (5.1708518973207687, 0.024056841951255323), (5.1688399314880371, 0.023916089823055663), (5.1663290622268256, 0.023741796884115096), (5.1655600324260771, 0.023688714786940037), (5.165001183881512, 0.023650228365313074), (5.1646770007201921, 0.023627936592914706), (5.1639461662237247, 0.023577773332075568), (5.1627837962006602, 0.023498249307992977), (5.1624398582495719, 0.023474779487238858), (5.1624290377297628, 0.023474041560783341), (5.1608982086181641, 0.023369919662108524), (5.1573882212870661, 0.023133238357390579), (5.1556523007519086, 0.023017233485885399), (5.1543383804893237, 0.022929887478906626), (5.1530594488231038, 0.022845244608143116), (5.1522739798885198, 0.022793444005746337), (5.1515817270940829, 0.022747906368443406), (5.1512711102289703, 0.022727508522371671), (5.149580443350219, 0.022616864310291002), (5.1493014190108424, 0.022598665344384931), (5.148268839707244, 0.022531467916887205), (5.1476376642699533, 0.02249050962601688), (5.1471918136022659, 0.022461630752419033), (5.1457042694091797, 0.022365597029165574), (5.1446205044254212, 0.022295937968048424), (5.144620118698005, 0.022295913221358956), (5.1426825523376465, 0.022172018102205669), (5.1412083927445451, 0.022078303396362652), (5.1411466210529637, 0.022074386773188657), (5.1411419836873309, 0.022074092775220888), (5.1392291923380995, 0.021953222923121993), (5.1338930083092187, 0.021620173741843735), (5.1338181495666504, 0.021615544584426289), (5.1328878593083411, 0.021558115331856944), (5.1324424743652344, 0.02153068502332374), (5.1323727252759799, 0.021526393099678052), (5.1319809884722591, 0.021502307029251638), (5.1313776239006392, 0.021465271867176838), (5.1298194690480674, 0.0213699824745337), (5.126706600189209, 0.021181123266858684), (5.1264670401427939, 0.0211666719053125), (5.1255326271057129, 0.021110416409926343), (5.1250347708642607, 0.021080516459661126), (5.1227006912231445, 0.020941011648110554), (5.1213202541609348, 0.020859024907355129), (5.1192083358764648, 0.020734336994510251), (5.1187516230714634, 0.020707490205560262), (5.1179652214050293, 0.020661361022784673), (5.1176905632019043, 0.020645279009630972), (5.1176701156274635, 0.02064408234690757), (5.1169681549072266, 0.02060305158184135), (5.116888561428544, 0.020598405388231298), (5.1156666474310306, 0.020527234849783478), (5.1154907821374351, 0.020517015858944814), (5.1138078048599169, 0.020419531397389105), (5.1137183465385583, 0.020414365212456074), (5.1102262128029627, 0.020213917090299214), (5.1099487549353562, 0.020198092687961317), (5.1071628463554584, 0.020040025338752883), (5.1069880999974639, 0.020030160237912945), (5.1063640593499029, 0.019994978419678098), (5.1063580513000488, 0.01999464006277828), (5.1062148915307164, 0.019986579735048714), (5.1058114407206752, 0.019963885267975552), (5.1053657531738281, 0.019938850997944145), (5.1051859855651855, 0.019928764148447319), (5.1044608079801641, 0.019888136408558139), (5.103879451751709, 0.019855638210465352), (5.1037501316969598, 0.019848417832386337), (5.1032079463650755, 0.01981818019010732), (5.1020712989421044, 0.019754969375151858), (5.1017999649047852, 0.019739915986616161), (5.0970551499876757, 0.019478899942677493), (5.0956039428710938, 0.019399900914651692), (5.0938429617133192, 0.019304557798279581), (5.0933203010652317, 0.019276368901489972), (5.0929350221473362, 0.019255621324210555), (5.0919032082940703, 0.019200190131769122), (5.0913210187343738, 0.019168998835009384), (5.0908157460532122, 0.01914197808321606), (5.0894819275529661, 0.019070869762943258), (5.089294708816861, 0.019060914384943294), (5.0864322037983838, 0.018909480912643894), (5.0861613767465705, 0.018895229073797638), (5.0855401790933294, 0.01886258866713424), (5.0849676132202148, 0.018832564069175609), (5.0841676959716651, 0.018790714383936744), (5.0837769979171137, 0.018770315008243155), (5.0833704555299848, 0.018749116853959844), (5.0831509535567054, 0.018737683529526976), (5.0829877853393555, 0.018729189971221291), (5.0829132885680322, 0.018725313668700335), (5.0812807083129883, 0.018640609159513332), (5.0812511794358608, 0.018639081372934473), (5.0810756683349609, 0.018630003786135309), (5.080062078337507, 0.018577684855988423), (5.0780508955927628, 0.018474399780899195), (5.0777368545532227, 0.018458335089377793), (5.0764980316162109, 0.018395128687867017), (5.0761686267024713, 0.018378366290666373), (5.075294017791748, 0.018333950148938086), (5.0731347996814149, 0.018224854005765793), (5.0725778092933425, 0.018196839861183811), (5.0717724040827141, 0.018156424153431359), (5.0705103103459255, 0.018093311054831258), (5.0664460032064733, 0.017891876266489099), (5.0654168128967285, 0.017841302017183949), (5.0642202533803431, 0.017782722280393997), (5.0637022214612424, 0.017757433889565254), (5.0635633595916394, 0.017750662629356227), (5.0631451606750488, 0.017730289206184878), (5.0629896200216011, 0.017722719004409429), (5.0613978442681926, 0.017645473256392766), (5.0611192158830969, 0.01763199428030689), (5.0602002022553476, 0.017587624974713108), (5.058135986328125, 0.017488462465815723), (5.0575568263124664, 0.017460763159749842), (5.0573153981232908, 0.017449232292444966), (5.0566831892083259, 0.017419081414963348), (5.0560200459228568, 0.017387523685978935), (5.0559178564877696, 0.017382666906465748), (5.0554664654053516, 0.017361233393242654), (5.0551892173997715, 0.017348084788927538), (5.0540816270884061, 0.017295678294635408), (5.0538315957913795, 0.017283874693869973), (5.0518735045355934, 0.01719177646063914), (5.0511251115192684, 0.01715673487399413), (5.0489399479432002, 0.017054919963808632), (5.0483726435474718, 0.017028608367230608), (5.0480403900146484, 0.01701322155528967), (5.0477183885461319, 0.016998325792096706), (5.046879411813757, 0.016959589886256805), (5.0465407371520996, 0.016943983828963432), (5.0464553833007812, 0.016940053522404613), (5.0461697532416663, 0.016926909190815173), (5.0456381436127495, 0.016902478510674137), (5.0453705260366206, 0.016890196244737126), (5.0450519033073551, 0.016875587392276112), (5.0443668365478516, 0.016844229591694595), (5.0439848899841309, 0.016826777689677948), (5.0432243347167969, 0.016792092502635293), (5.0429245211417824, 0.016778443622228422), (5.0425913943920948, 0.016763294159730636), (5.0418610093049523, 0.016730137544080845), (5.0411714973908035, 0.016698910357106623), (5.0381894111633301, 0.016564677780008225), (5.0378932952880859, 0.016551421307543702), (5.037320613861084, 0.01652582061942667), (5.0362415152924953, 0.016477713819070806), (5.0347909589508326, 0.016413318678191898), (5.0345834368387719, 0.016404131434796423), (5.0337989491525805, 0.016369458471508811), (5.0325285031902878, 0.016313498421560473), (5.0320330893124465, 0.016291740590295371), (5.0318736695207571, 0.016284746725863018), (5.0318264792939642, 0.016282677166030303), (5.0312626965986542, 0.016257977162729458), (5.030927646931695, 0.016243320127908627), (5.0308780670166016, 0.016241152597048145), (5.0299920584153073, 0.016202478254725178), (5.0295468302679875, 0.016183086922606088), (5.0287507902142998, 0.016148487787689677), (5.0287017114280204, 0.016146357614774641), (5.0275692939758301, 0.016097303390953787), (5.0266480887400338, 0.016057534221543539), (5.026390757554414, 0.016046446726595838), (5.0252604484558105, 0.015997857596988557), (5.0238156923275561, 0.015936015731766142), (5.0233917778978521, 0.01591792647107244), (5.0231657028198242, 0.015908289789152881), (5.0228637170659471, 0.015895428594222546), (5.0225830078125, 0.015883485074443475), (5.0225529670715332, 0.015882207569314979), (5.0220760752803644, 0.015861944407773398), (5.0219300400775504, 0.015855745762849621), (5.0214920519994548, 0.01583717278947756), (5.0211225435120959, 0.015821524647616783), (5.0195278596884547, 0.015754211323998037), (5.0194535255432129, 0.015751082260382882), (5.0193593519139004, 0.015747119167736343), (5.0188538790599413, 0.015725868538074006), (5.0183794587353834, 0.015705955706820571), (5.0183356534504924, 0.015704118644925366), (5.0182361602783203, 0.015699947189671166), (5.0171450098243078, 0.015654288470360999), (5.0171027546191613, 0.015652523632422234), (5.016695499420166, 0.01563552678376524), (5.0150735661812407, 0.015568061868722156), (5.014855244464032, 0.01555900829282293), (5.0140025967538353, 0.015523712395432585), (5.0136017799377441, 0.015507154664963281), (5.0135027455669929, 0.015503066935968066), (5.0134344100952148, 0.015500247110385664), (5.01264039764387, 0.015467529260759207), (5.0121183395385742, 0.015446064203111084), (5.0117278099060059, 0.015430031283997435), (5.0107316970825195, 0.015389230089771109), (5.0102384266087405, 0.015369075154835555), (5.0098476409912109, 0.015353131016075348), (5.0094523429870605, 0.015337023682495588), (5.0091733783017736, 0.01532566926171771), (5.0086465759831329, 0.015304255842044706), (5.0082076181842226, 0.015286441528748518), (5.0077291335638456, 0.015267052457623441), (5.0074648955132766, 0.015256358159596641), (5.0074045337050208, 0.015253916491438656), (5.0071731352304303, 0.015244560799360539), (5.0066411791496224, 0.015223080292539728), (5.0064859390258789, 0.015216818761481054), (5.0063360834288604, 0.015210777452475554), (5.0061293188691707, 0.015202446803671183), (5.0060541020231355, 0.015199417687491753), (5.005869641735643, 0.015191992323095658), (5.0057342392664586, 0.015186544632165242), (5.0050508250152568, 0.015159085689664294), (5.0050139427185059, 0.015157605552276873), (5.0048954085056492, 0.015152849829287045), (5.0048722216774859, 0.015151919765506509), (5.004417896270752, 0.015133710321460849), (5.0044163034166562, 0.015133646527535721), (5.0043802541118243, 0.015132202839750943), (5.0033273696899414, 0.015090112920938474), (5.002903938293457, 0.015073227029235591), (5.0026768154975594, 0.015064179369319444), (5.001565406887031, 0.015020002780728226), (5.0011477470397949, 0.015003443270381065), (5.0009505561408041, 0.014995632893377657), (5.0003754230112198, 0.014972881843717216)]
		#purity_list=[(6.3787398338317871, 0.62087677133318231), (6.1397081335444383, 0.43316397881155799), (6.1353536400579953, 1.), (6.0771536827087402, 0.21005190256505829), (6.0593472021053438, 0.71079835359145338), (5.999498532351855, 0.32773995713716614), (5.966244586128771, 0.30474422451358191), (5.8916816711425781, 0.2568591781620278), (5.8759499583026686, 0.11588649843758494), (5.8284187316894531, 0.099945575296214062), (5.8124513626098633, 0.095066533948564264), (5.8067856724781599, 0.51952725674881595), (5.8034805710434041, 0.17599146802243115), (5.6524477005004883, 0.39783342449604497), (5.6400434687554695, 0.38848607749021752), (5.6302310248665766, 0.053550992482243091), (5.6273612684342345, 0.05307217974867344), (5.6153931005715014, 0.12836825265308247), (5.6136555671691895, 0.050846923389169144), (5.602501318888562, 0.1241538620073707), (5.5992416680064077, 0.10161773555105662), (5.5945631135501452, 0.04791059406860549), (5.5897271140895572, 0.047195906873382931), (5.5629539489746094, 0.33282186507675338), (5.5535618453090239, 0.042201089911739036), (5.5407942806846311, 0.3177047109512729), (5.5379783645476222, 0.040228041511106601), (5.5146455764770508, 0.098946049946416856), (5.5100846102672012, 0.036943633538655193), (5.5081391334533691, 0.036725820236715681), (5.4922447204589844, 0.07539728523760518), (5.4805184952635679, 0.090658232875660147), (5.4771368230113291, 0.089878638366244365), (5.469665282971877, 0.088181872284667784), (5.4628787040710449, 0.032040090152560895), (5.4622343394337847, 0.031978388226168157), (5.4512537419722342, 0.084148079492921884), (5.4426462346939504, 0.082332186532871068), (5.4350762367248535, 0.029495535835986342), (5.4305567741394043, 0.40429465342130627), (5.4282169438354426, 0.028903420883110008), (5.4271397590637207, 0.079169348529148115), (5.4251118410972436, 0.02863982411971526), (5.416776562819682, 0.027945647257735691), (5.4154108586408656, 0.027833746041614559), (5.4151001551434774, 0.02780835944044633), (5.4124247816205715, 0.027590852807722339), (5.4111062239923529, 0.02748436947101978), (5.4070615637049633, 0.38733086400811118), (5.4048484855182206, 0.02698537064537563), (5.4034132208549144, 0.026872387101430154), (5.4006396897594504, 0.026655587075885938), (5.3988690376281738, 0.23188456162519308), (5.3975882580998134, 0.07351092487886994), (5.3971091087244556, 0.02638250444909624), (5.3933752564958963, 0.026097185857713874), (5.3916111253198071, 0.025963615422319009), (5.3894555231948944, 0.025801470415896016), (5.3870773275196138, 0.025623931719986486), (5.3865934957052737, 0.025587984737218159), (5.3841944318846471, 0.025410598519108037), (5.3834014423614631, 0.025352276910230589), (5.3828642808423472, 0.02531285820711883), (5.381627082824707, 0.025222336991394465), (5.3815221786499023, 0.36927759186811593), (5.380161093464686, 0.070389022865952278), (5.3758797869338517, 0.2198695809406212), (5.375789258936698, 0.069629764002047137), (5.3753480824973447, 0.21959798329412791), (5.3695745468139648, 0.068566550008454769), (5.3685804217994963, 0.024290169936285744), (5.3655842307598434, 0.35823579926138177), (5.3619072526541061, 0.023828827509338252), (5.3567392951036474, 0.023478525718853033), (5.3552275139074021, 0.023377186132383827), (5.3550141950882999, 0.02336292768147644), (5.3533232971042706, 0.051246764402778151), (5.3516416709319516, 0.023138844131238429), (5.3515228228079144, 0.34864746092634569), (5.3453197822332346, 0.022725504382154232), (5.3389495876425102, 0.022317696744267305), (5.3359274864196777, 0.022127223571892913), (5.3356967513631011, 0.063090061816458542), (5.333989320265899, 0.19933574889749536), (5.3276361634956357, 0.19637307279528013), (5.3264613151550293, 0.19582952808526716), (5.3261656761169434, 0.021524851850657663), (5.3223810167547745, 0.19395222538774645), (5.3155011347681258, 0.020888662833161143), (5.3153028873873298, 0.02087704771684026), (5.315129759070377, 0.020866910528191753), (5.3150300557092747, 0.020861075226645504), (5.313279836630084, 0.020758953465058783), (5.3129260585429083, 0.18966422080023379), (5.310735944574617, 0.059380460222474875), (5.3065336289759788, 0.020370806085377797), (5.3059857114519611, 0.058703967862131161), (5.3018452523213639, 0.020106105257022163), (5.2972212131155425, 0.057479652932201246), (5.2962533622626538, 0.019795700054675958), (5.295146577664994, 0.019734938021472425), (5.2943778038024902, 0.043630349725827439), (5.2914203524621231, 0.043282504480331843), (5.289726887842308, 0.30837301676514495), (5.2882620219361813, 0.019361912663431746), (5.2852423240150506, 0.019200944756716416), (5.28413360718171, 0.019142243669153132), (5.2841072082519531, 0.019140848582964894), (5.280606890618075, 0.018956937874658825), (5.2778287221569791, 0.018812468039507448), (5.277724850577588, 0.041711431123704658), (5.2766761779785156, 0.054727187728309999), (5.2753402953983333, 0.041444449123869305), (5.2749396689555583, 0.054501873266950628), (5.2740904301806824, 0.29869766854187141), (5.2739773899990583, 0.01861435933406546), (5.2723101651636668, 0.054162815238479267), (5.2718198556384657, 0.018504467360071924), (5.2710304260253906, 0.018464452470851715), (5.2701412867715565, 0.29628857866486696), (5.2698569388006868, 0.053848778787411476), (5.2689428329467773, 0.018359133639180465), (5.2686815184465665, 0.0183460010445156), (5.2650589942932129, 0.018165101757821923), (5.2648004298591697, 0.018152271642851603), (5.2647671699523926, 0.018150622055915857), (5.2630753298438222, 0.018066948698337953), (5.2604360580444336, 0.29042802406364615), (5.2559429794665062, 0.052108764304600472), (5.2548641010969339, 0.017667362473899065), (5.2532949607586676, 0.051785388955562811), (5.2523202108415861, 0.16419053784920545), (5.2515878677368164, 0.017510900189289576), (5.2515301704406738, 0.017508159732647074), (5.249366504139422, 0.017405763658902871), (5.2480931282043457, 0.28309895621090703), (5.2431520477445277, 0.017115652340369145), (5.2431489561674391, 0.01711550947396422), (5.243134657623405, 0.017114848735575009), (5.2425491902122827, 0.017087820612020625), (5.2401651978299615, 0.016978294615715123), (5.2400206666010769, 0.01697168184263266), (5.2361010912781971, 0.27611304617540627), (5.2305198637611747, 0.016543744728135194), (5.2302705468367066, 0.036743406840856599), (5.2300004788103172, 0.016520729648137281), (5.2271535227590036, 0.016395262694518492), (5.2257177649104207, 0.048559300336365241), (5.2246365945295521, 0.15366996091592572), (5.2234482765197754, 0.016233698721969315), (5.2223157585923019, 0.26824834162715322), (5.2196288108825684, 0.047880625390527447), (5.2187667131347864, 0.26625247626735399), (5.2174672252937944, 0.015976965228711677), (5.2160892371631427, 0.047491497707349797), (5.2152347564697266, 0.0473981474053458), (5.2149467125582456, 0.04736673050427171), (5.2149216259107725, 0.26410354017115062), (5.2143783569335938, 0.015846314015820907), (5.2134315578519761, 0.015806527950541958), (5.2121636247985812, 0.015753438024736173), (5.2114691792950909, 0.015724452976421506), (5.2073147732050664, 0.25989342915186453), (5.2039017677307129, 0.015412786927823195), (5.2020387098339507, 0.015337218896752556), (5.2006378389657533, 0.015280696540244059), (5.1995296478271484, 0.25564145825655105), (5.1990692500405071, 0.015217709757964918), (5.197101461223717, 0.015139142687805824), (5.1937857447963687, 0.015007880427446578), (5.1932929142829032, 0.25227671723068235), (5.1921415328979492, 0.014943308104943221), (5.1903111985961017, 0.014871827526472601), (5.1849884213737294, 0.044236306154429458), (5.1846176729406093, 0.01465215085708702), (5.1843380849510909, 0.04417127375628848), (5.1813092231750488, 0.014526335149108675), (5.1794276237487793, 0.043684109381725678), (5.1788940044085043, 0.014435328873102624), (5.1781392731517899, 0.014407034822259343), (5.1779062455287495, 0.014398312717095501), (5.1750235557556152, 0.043252945117317643), (5.1743106842041016, 0.01426455640625706), (5.173581515629162, 0.014237618750939931), (5.1732939989599371, 0.014227014337503088), (5.1716168183894604, 0.014165349752814299), (5.1708518973207687, 0.042849492468079113), (5.1688399314880371, 0.2394415866506569), (5.1663290622268256, 0.013973091536549289), (5.1655600324260771, 0.013945400502762609), (5.165001183881512, 0.042291667076220195), (5.1646770007201921, 0.01391368847433002), (5.1639461662237247, 0.13288673074832533), (5.1627837962006602, 0.013845999698692969), (5.1624398582495719, 0.013833746641043579), (5.1624290377297628, 0.013833361370255275), (5.1608982086181641, 0.041905980913475235), (5.1573882212870661, 0.013655321802092377), (5.1556523007519086, 0.01359467059445852), (5.1543383804893237, 0.013548986630063499), (5.1530594488231038, 0.041181523659649576), (5.1522739798885198, 0.013477594901446913), (5.1515817270940829, 0.041046752417882151), (5.1512711102289703, 0.23057146868134637), (5.149580443350219, 0.013385150286908063), (5.1493014190108424, 0.12831488892453685), (5.148268839707244, 0.2290850392059193), (5.1476376642699533, 0.040689804929177432), (5.1471918136022659, 0.013303831824561853), (5.1457042694091797, 0.013253501724002954), (5.1446205044254212, 0.040419432091509146), (5.144620118698005, 0.040419397673745222), (5.1426825523376465, 0.029253040713333338), (5.1412083927445451, 0.029143207306516265), (5.1411466210529637, 0.013100772270063968), (5.1411419836873309, 0.013100617994533407), (5.1392291923380995, 0.039942038424986857), (5.1338930083092187, 0.012862218683310948), (5.1338181495666504, 0.012859785307739355), (5.1328878593083411, 0.012829593273506589), (5.1324424743652344, 0.028500125574339636), (5.1323727252759799, 0.012812913205881741), (5.1319809884722591, 0.03931162469434818), (5.1313776239006392, 0.01278076887794777), (5.1298194690480674, 0.012730639884739832), (5.126706600189209, 0.012631231207570625), (5.1264670401427939, 0.012623621485205542), (5.1255326271057129, 0.038761568348840099), (5.1250347708642607, 0.027969832495924357), (5.1227006912231445, 0.012504737805762341), (5.1213202541609348, 0.03840763652933827), (5.1192083358764648, 0.01239576189926825), (5.1187516230714634, 0.01238159937814152), (5.1179652214050293, 0.038128746149171236), (5.1176905632019043, 0.012348775084508413), (5.1176701156274635, 0.038104341746260227), (5.1169681549072266, 0.012326490020023128), (5.116888561428544, 0.012324037807299078), (5.1156666474310306, 0.037939198697823341), (5.1154907821374351, 0.012281073692080284), (5.1138078048599169, 0.012229594426199487), (5.1137183465385583, 0.21259180503741446), (5.1102262128029627, 0.012120946161099121), (5.1099487549353562, 0.11682535248273715), (5.1071628463554584, 0.012028987450713263), (5.1069880999974639, 0.20950927964646762), (5.1063640593499029, 0.03718454840259177), (5.1063580513000488, 0.012004975383409238), (5.1062148915307164, 0.012000710409213144), (5.1058114407206752, 0.011988701266254167), (5.1053657531738281, 0.011975452636761972), (5.1051859855651855, 0.011970114078641228), (5.1044608079801641, 0.011948609151678613), (5.103879451751709, 0.011931404642381443), (5.1037501316969598, 0.011927581858218203), (5.1032079463650755, 0.011911571444749976), (5.1020712989421044, 0.036842947124637454), (5.1017999649047852, 0.1145853495682074), (5.0970551499876757, 0.20503667285974855), (5.0956039428710938, 0.011689883862866386), (5.0938429617133192, 0.036199638110115777), (5.0933203010652317, 0.036159278084465583), (5.0929350221473362, 0.011613321831092394), (5.0919032082940703, 0.011583894248793225), (5.0913210187343738, 0.025700969711390336), (5.0908157460532122, 0.011552982542712109), (5.0894819275529661, 0.035864694729326796), (5.089294708816861, 0.20160562189801595), (5.0864322037983838, 0.20035399496796133), (5.0861613767465705, 0.011421864581149462), (5.0855401790933294, 0.035565479595256633), (5.0849676132202148, 0.011388542270232501), (5.0841676959716651, 0.011366283281729884), (5.0837769979171137, 0.011355431732934299), (5.0833704555299848, 0.011344154198795127), (5.0831509535567054, 0.011338071153866917), (5.0829877853393555, 0.011333551991254083), (5.0829132885680322, 0.011331489470833926), (5.0812807083129883, 0.011286410357608911), (5.0812511794358608, 0.011285597119761126), (5.0810756683349609, 0.011280765019824578), (5.080062078337507, 0.035155125109114067), (5.0780508955927628, 0.03500605387735712), (5.0777368545532227, 0.03498285293021984), (5.0764980316162109, 0.10791956862555342), (5.0761686267024713, 0.011146734705143302), (5.075294017791748, 0.011123060897809903), (5.0731347996814149, 0.03464520217848005), (5.0725778092933425, 0.034604632042888189), (5.0717724040827141, 0.0110283900800259), (5.0705103103459255, 0.034454594277939787), (5.0664460032064733, 0.010887163928618273), (5.0654168128967285, 0.024108049466793999), (5.0642202533803431, 0.034003456614225713), (5.0637022214612424, 0.033966656605166928), (5.0635633595916394, 0.03395680122532381), (5.0631451606750488, 0.033927143814295291), (5.0629896200216011, 0.010796766645204875), (5.0613978442681926, 0.010755461889202915), (5.0611192158830969, 0.010748252824361449), (5.0602002022553476, 0.033719280391064942), (5.058135986328125, 0.010671456900433886), (5.0575568263124664, 0.023648806869160044), (5.0573153981232908, 0.10314698275561339), (5.0566831892083259, 0.010634315373767808), (5.0560200459228568, 0.010617417435628567), (5.0559178564877696, 0.033420072810201935), (5.0554664654053516, 0.18728867254985659), (5.0551892173997715, 0.033369520066906709), (5.0540816270884061, 0.010568222625028295), (5.0538315957913795, 0.010561898662706362), (5.0518735045355934, 0.033140778478396235), (5.0511251115192684, 0.023281016857527807), (5.0489399479432002, 0.010439158000542537), (5.0483726435474718, 0.010425043430337157), (5.0480403900146484, 0.03287898180811135), (5.0477183885461319, 0.010408796321094049), (5.046879411813757, 0.010388010182718338), (5.0465407371520996, 0.18368162197171878), (5.0464553833007812, 0.02301840872172279), (5.0461697532416663, 0.032752238239129219), (5.0456381436127495, 0.010357356004645275), (5.0453705260366206, 0.032698289590136043), (5.0450519033073551, 0.010342919238646369), (5.0443668365478516, 0.032630710536630816), (5.0439848899841309, 0.010316710134449561), (5.0432243347167969, 0.18235924640963272), (5.0429245211417824, 0.022822280297753975), (5.0425913943920948, 0.010282611772734219), (5.0418610093049523, 0.010264798168297182), (5.0411714973908035, 0.032416828056203037), (5.0381894111633301, 0.18036998671170498), (5.0378932952880859, 0.03219938010231517), (5.037320613861084, 0.010154959296176061), (5.0362415152924953, 0.03209056922435171), (5.0347909589508326, 0.010094428700063789), (5.0345834368387719, 0.010089483991385184), (5.0337989491525805, 0.010070820310848886), (5.0325285031902878, 0.031847803892238458), (5.0320330893124465, 0.17796757087348927), (5.0318736695207571, 0.010025207296638403), (5.0318264792939642, 0.031802186848511098), (5.0312626965986542, 0.010010788916335556), (5.030927646931695, 0.01000289359551737), (5.0308780670166016, 0.010001725956344422), (5.0299920584153073, 0.0099808899634574923), (5.0295468302679875, 0.031654673120142585), (5.0287507902142998, 0.009951795037446861), (5.0287017114280204, 0.0099506469337018993), (5.0275692939758301, 0.0099242043966114996), (5.0266480887400338, 0.031468451839602285), (5.026390757554414, 0.0098967827935700359), (5.0252604484558105, 0.0098705767052828589), (5.0238156923275561, 0.031287944685397417), (5.0233917778978521, 0.031261051565512808), (5.0231657028198242, 0.009822250816826722), (5.0228637170659471, 0.0312275959282706), (5.0225830078125, 0.0098088633285996693), (5.0225529670715332, 0.0098081737895951634), (5.0220760752803644, 0.0097972360070004635), (5.0219300400775504, 0.17409565874913474), (5.0214920519994548, 0.094846056554644523), (5.0211225435120959, 0.031117631799322958), (5.0195278596884547, 0.094412985989785078), (5.0194535255432129, 0.0097373723151194871), (5.0193593519139004, 0.0097352316272954504), (5.0188538790599413, 0.0097237521657475481), (5.0183794587353834, 0.17275560140134275), (5.0183356534504924, 0.009712001591562703), (5.0182361602783203, 0.0097097477619531389), (5.0171450098243078, 0.0096850749906676348), (5.0171027546191613, 0.1722763597990897), (5.016695499420166, 0.009674934833087635), (5.0150735661812407, 0.030739736631746784), (5.014855244464032, 0.030726216468456115), (5.0140025967538353, 0.021291693679738259), (5.0136017799377441, 0.030648751488561589), (5.0135027455669929, 0.0096033134813031905), (5.0134344100952148, 0.0096017882103940615), (5.01264039764387, 0.030589520709273125), (5.0121183395385742, 0.17041850230261396), (5.0117278099060059, 0.0095637998907077987), (5.0107316970825195, 0.0095417185405411165), (5.0102384266087405, 0.0095308089114801639), (5.0098476409912109, 0.0095221776426630319), (5.0094523429870605, 0.030394237455901269), (5.0091733783017736, 0.0095073095232768735), (5.0086465759831329, 0.030345154706755823), (5.0082076181842226, 0.030318462251547284), (5.0077291335638456, 0.0209768526208206), (5.0074648955132766, 0.0094697732026118829), (5.0074045337050208, 0.030269712189786399), (5.0071731352304303, 0.020949233436690855), (5.0066411791496224, 0.030223474931433358), (5.0064859390258789, 0.091593403993868144), (5.0063360834288604, 0.0094450801796120247), (5.0061293188691707, 0.030192526021148802), (5.0060541020231355, 0.030187981860004234), (5.005869641735643, 0.0094349015690023217), (5.0057342392664586, 0.020877969391329753), (5.0050508250152568, 0.030127460738056024), (5.0050139427185059, 0.020842410437448985), (5.0048954085056492, 0.0094136888674618106), (5.0048722216774859, 0.0094131847741715062), (5.004417896270752, 0.0094033147294740067), (5.0044163034166562, 0.030089271461250004), (5.0043802541118243, 0.16757551479846189), (5.0033273696899414, 0.16719253667571024), (5.002903938293457, 0.0093705234964680563), (5.0026768154975594, 0.0093656172762307272), (5.001565406887031, 0.020673223936474916), (5.0011477470397949, 0.0093326755220625047), (5.0009505561408041, 0.0093284385122966752), (5.0003754230112198, 0.029847644663837828)]		
		temp_pur=[pur[1] for pur in purity_list if pur[0]==self.SNR]
		if len(temp_pur)>0:
			self.purity=temp_pur[0]
		else:
			self.purity=0
	def assign_flux_corr(self):
		if self.SNR>7:
			self.flux_correct=1.
			self.flux_correct_range=(1.,1.)
			from scipy.stats import norm
			self.bestf=norm(loc=1.,scale=1e-8)
		else:
			lognorm_param={-1:[-0.15916484 , 0.31469189],0:[ 0.20880513 , 0.50462498],2:[ 0.47371305 , 0.49016163],4:[ 0.58648468 , 0.52691963],6:[ 0.62126716 , 0.56690165],8:[ 0.94227055 , 0.62524381]}
			from scipy.stats import lognorm
			self.bestf=lognorm(s=lognorm_param[min(8,self.spat_templ)][1],scale=np.exp(lognorm_param[min(8,self.spat_templ)][0])) 
			self.flux_correct=self.bestf.median()
			self.flux_correct_range=self.bestf.interval(.68)
	def assign_compl(self,flux_to_use):
		if np.isnan(flux_to_use):
			return np.nan
		myfit=lambda f,d,f0: max(0,1-(   1./(f+d)*np.exp(-f/f0)   ))
		compl_params_fit=np.array([[[ 0.30244889,  0.0647361 ],[ 0.19111455,  0.0863606 ],[ 0.26355572,  0.11940371]],       [[ 0.34815344,  0.11987698],       [ 0.3085827 ,  0.17502077],        [ 0.3268172 ,  0.23117797]],       [[ 0.37420752,  0.21330359],        [ 0.30220447,  0.30313399],        [ 0.29627785,  0.40176673]]])
		comple=0
		for spat_bin in [0,1,2]:
			for freq_bin in [0,1,2]:
				param=compl_params_fit[spat_bin,freq_bin]
				comple+=self.size_prob[spat_bin]*self.FWHM_prob[freq_bin]*myfit(flux_to_use,*param)
		return max(.1,comple)
	def calc_L_prime(self,sdv,nu_obs,J=1):
		z=115.27*J/nu_obs-1
		from astropy.cosmology import FlatLambdaCDM
		cosmo = FlatLambdaCDM(H0=70, Om0=0.3)
		DL=cosmo.luminosity_distance(z).value
		return 3.25e7*sdv*DL**2/(1+z)**3/nu_obs**2      
	def completeness_withbins(self,complet_bins):
		return np.sum(np.outer(self.size_prob,self.FWHM_prob).flatten()*np.array(complet_bins))
	def calc_ra_dec_freq(self,posn):
		import pyfits,pywcs
		f=pyfits.open('/data2/common/goodsN/GNmosaic_new.fits')
		mywcs=pywcs.WCS(f[0].header)
		return mywcs.wcs_pix2sky(np.array([posn]),0)[0][:3]




